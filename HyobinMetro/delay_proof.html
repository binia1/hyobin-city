<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간편 지연증명서 - 효빈교통공사</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Nanum+Myeongjo:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .hb-logo { font-family: sans-serif; font-weight: 900; letter-spacing: -2px; }
        
        /* 도장 스타일 */
        .official-seal {
            width: 100px;
            height: 100px;
            border: 3px solid #cc0000;
            border-radius: 50%;
            color: #cc0000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Nanum Myeongjo', serif;
            font-weight: 900;
            font-size: 18px;
            text-align: center;
            line-height: 1.2;
            transform: rotate(-15deg);
            opacity: 0.8;
            position: absolute;
            bottom: 40px;
            right: 40px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* 인쇄용 스타일 */
        @media print {
            body * { visibility: hidden; }
            #certificate-modal, #certificate-modal * { visibility: visible; }
            #certificate-modal { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                height: 100%; 
                background: white; 
                padding: 0;
                margin: 0;
                border: none;
                box-shadow: none;
            }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">

    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2 group">
                <img src="images/logo.png" onerror="this.style.display='none'" class="h-8 w-auto">
                <div class="text-3xl font-black text-sky-600 hb-logo">HB</div>
                <span class="text-lg font-bold text-gray-800">지연증명서 발급</span>
            </a>
            <a href="index.html" class="text-gray-500 hover:text-black"><i class="fa-solid fa-xmark text-2xl"></i></a>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-12 flex-grow w-full">
        
        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm mb-8 no-print">
            <h1 class="text-2xl font-bold text-slate-800 mb-4"><i class="fa-solid fa-clock-rotate-left text-sky-600 mr-2"></i>간편 지연증명서 발급</h1>
            <ul class="list-disc list-inside text-sm text-slate-600 space-y-2">
                <li>효빈 도시철도 및 빈효선 광역전철의 <strong>5분 이상 지연</strong> 운행 시 발급 가능합니다.</li>
                <li>최근 <strong>30일 이내</strong>의 지연 내역만 조회 및 발급이 가능합니다.</li>
                <li>30일이 경과한 내역이나, 웹사이트에 조회되지 않는 지연은 고객센터(079-591-2548)로 문의 바랍니다.</li>
                <li>본 증명서는 학교, 회사 제출용으로 사용할 수 있는 <strong>공식 효력</strong>을 가집니다.</li>
            </ul>
        </div>

        <div class="bg-slate-100 p-6 rounded-xl mb-8 flex flex-col md:flex-row gap-4 items-end no-print">
            <div class="w-full md:w-1/3">
                <label class="block text-sm font-bold text-slate-700 mb-2">날짜 선택</label>
                <input type="date" id="search-date" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
            </div>
            <div class="w-full md:w-1/3">
                <label class="block text-sm font-bold text-slate-700 mb-2">노선 선택</label>
                <select id="search-line" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <option value="all">전체 노선</option>
                    <option value="1">1호선</option>
                    <option value="2">2호선</option>
                    <option value="3">3호선</option>
                    <option value="4">4호선</option>
                    <option value="5">5호선</option>
                    <option value="6">6호선</option>
                    <option value="7">7호선</option>
                    <option value="8">8호선</option>
                    <option value="binhyo">빈효선</option>
                </select>
            </div>
            <div class="w-full md:w-1/3">
                <button onclick="searchDelay()" class="w-full bg-sky-600 text-white font-bold p-3 rounded-lg hover:bg-sky-700 transition">
                    <i class="fa-solid fa-magnifying-glass mr-2"></i>조회하기
                </button>
            </div>
        </div>

        <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden no-print">
            <table class="w-full text-center">
                <thead class="bg-slate-50 border-b border-slate-200 text-slate-600 font-bold">
                    <tr>
                        <th class="p-4">발생 일자</th>
                        <th class="p-4">발생 시각</th>
                        <th class="p-4">노선</th>
                        <th class="p-4">지연 시간</th>
                        <th class="p-4">증명서</th>
                    </tr>
                </thead>
                <tbody id="result-body" class="divide-y divide-slate-100 text-sm">
                    <tr>
                        <td colspan="5" class="p-8 text-slate-400">날짜와 노선을 선택하고 조회 버튼을 눌러주세요.</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </main>

    <footer class="bg-slate-900 text-slate-400 text-xs py-8 mt-auto no-print">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="mb-4">
                <span class="text-2xl font-black text-sky-600 tracking-tighter mr-2">HB</span>
                <span class="font-bold text-white">효빈교통공사</span>
            </div>
            <p>Copyright 2016. 효빈교통공사 All right reserved.</p>
        </div>
    </footer>

    <div id="modal-overlay" class="fixed inset-0 bg-black/50 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm no-print">
        
        <div id="certificate-modal" class="bg-white w-[210mm] min-h-[297mm] p-12 md:p-16 relative shadow-2xl animate-fade-in mx-auto flex flex-col">
            
            <div class="absolute top-4 right-4 flex gap-2 no-print">
                <button onclick="window.print()" class="bg-slate-800 text-white px-4 py-2 rounded hover:bg-black transition text-sm font-bold"><i class="fa-solid fa-print mr-2"></i>인쇄</button>
                <button onclick="closeModal()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 transition text-sm font-bold">닫기</button>
            </div>

            <div class="border-4 double border-slate-800 h-full p-8 flex flex-col justify-between flex-grow">
                
                <div class="text-center mt-8">
                    <div class="text-4xl font-black text-sky-600 mb-2 hb-logo tracking-tighter">HB</div>
                    <div class="text-xl font-bold text-slate-500 mb-12">효빈교통공사</div>
                    <h1 class="text-5xl font-black text-black underline decoration-4 underline-offset-8 decoration-slate-300 font-serif">지 연 증 명 서</h1>
                    <p class="text-right mt-12 text-slate-500">문서번호 : HB-DELAY-<span id="cert-id">0000</span></p>
                </div>

                <div class="mt-12 space-y-8 text-lg leading-relaxed">
                    <p>귀하의 건승을 빕니다.</p>
                    <p>효빈교통공사에서 운행하는 열차가 아래와 같은 사유로 인하여 도착이 지연되었음을 증명합니다.</p>
                    
                    <div class="border-t-2 border-b-2 border-slate-800 py-6 my-8">
                        <table class="w-full text-left">
                            <tr class="border-b border-slate-200">
                                <th class="py-4 pl-4 w-32 bg-slate-50">지연 일자</th>
                                <td class="py-4 pl-8 font-bold text-xl" id="cert-date">2025년 00월 00일</td>
                            </tr>
                            <tr class="border-b border-slate-200">
                                <th class="py-4 pl-4 bg-slate-50">지연 노선</th>
                                <td class="py-4 pl-8 font-bold text-xl" id="cert-line">1호선</td>
                            </tr>
                            <tr class="border-b border-slate-200">
                                <th class="py-4 pl-4 bg-slate-50">지연 시간</th>
                                <td class="py-4 pl-8 font-bold text-xl text-red-600"><span id="cert-min">00</span>분</td>
                            </tr>
                            <tr>
                                <th class="py-4 pl-4 bg-slate-50">지연 사유</th>
                                <td class="py-4 pl-8">열차 운행 지연 (신호 관계 및 혼잡)</td>
                            </tr>
                        </table>
                    </div>

                    <p class="text-sm text-slate-500 mt-4">
                        ※ 본 증명서는 효빈교통공사 관할 구간 내에서 발생한 지연에 한하여 유효합니다.<br>
                        ※ 지연 시간은 해당 열차의 최대 지연 시분을 기준으로 합니다.
                    </p>
                </div>

                <div class="mt-auto pt-20 text-center relative">
                    <p class="text-xl mb-4" id="cert-today">2025년 12월 15일</p>
                    <h2 class="text-4xl font-black font-serif tracking-widest text-black">효빈교통공사 사장</h2>
                    
                    <div class="official-seal">
                        효빈<br>교통공사<br>사장인
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // 날짜 헬퍼 함수
        function getDateString(daysOffset) {
            const d = new Date();
            d.setDate(d.getDate() - daysOffset);
            return d.toISOString().split('T')[0];
        }

        // ============================================
        // ★ 1. 수동 데이터 추가 (여기에 원하는 데이터를 넣으세요) ★
        // ============================================
        const manualDelays = [
            {
                id: 2025121501,
                date: getDateString(0), // 오늘 (2025-12-15)
                time: "08:35",
                line: "1",
                delay: 15
            },
            {
                id: 2025121502,
                date: getDateString(0), // 오늘 (2025-12-15)
                time: "18:40",
                line: "2",
                delay: 8
            },
            {
                id: 2025121401,
                date: getDateString(1), // 어제
                time: "07:50",
                line: "3",
                delay: 12
            },
            {
                id: 2025121301,
                date: getDateString(2), // 2일 전
                time: "09:10",
                line: "binhyo",
                delay: 25
            },
            {
                id: 2025121001,
                date: getDateString(5), // 5일 전
                time: "19:00",
                line: "1",
                delay: 20
            }
        ];

        // 2. 가상 데이터 생성 (나머지 날짜 랜덤 생성)
        const mockDelays = [...manualDelays]; // 수동 데이터 먼저 넣기
        const lines = ["1", "2", "3", "4", "5", "6", "7", "8", "binhyo"];
        const lineNames = { "1": "1호선", "2": "2호선", "3": "3호선", "4": "4호선", "5": "5호선", "6": "6호선", "7": "7호선", "8": "8호선", "binhyo": "빈효선" };
        
        // 오늘 날짜 기준 설정
        const today = new Date();
        document.getElementById('search-date').valueAsDate = today;

        // 랜덤 데이터 추가 (수동 데이터와 겹치지 않게 날짜 분산)
        for (let i = 0; i < 40; i++) {
            let offset = Math.floor(Math.random() * 30);
            let dString = getDateString(offset);
            
            // 수동 데이터에 이미 있는 날짜/노선 조합은 피하거나 그냥 추가 (여기선 그냥 추가)
            let h = 6 + Math.floor(Math.random() * 16); 
            let m = Math.floor(Math.random() * 60);
            let timeStr = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
            let delayMin = 5 + Math.floor(Math.random() * 20);

            // 랜덤 ID 생성
            let randId = 20250000 + Math.floor(Math.random() * 9000) + i;

            mockDelays.push({
                id: randId,
                date: dString,
                time: timeStr,
                line: lines[Math.floor(Math.random() * lines.length)],
                delay: delayMin
            });
        }
        
        // 최신순 정렬 (날짜 -> 시간 내림차순)
        mockDelays.sort((a, b) => {
            if (b.date !== a.date) return b.date.localeCompare(a.date);
            return b.time.localeCompare(a.time);
        });

        // 3. 검색 함수
        function searchDelay() {
            const sDate = document.getElementById('search-date').value;
            const sLine = document.getElementById('search-line').value;
            const tbody = document.getElementById('result-body');
            
            tbody.innerHTML = "";

            const results = mockDelays.filter(d => {
                let dateMatch = (d.date === sDate);
                let lineMatch = (sLine === 'all' || d.line === sLine);
                return dateMatch && lineMatch;
            });

            if (results.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-slate-500">해당 조건의 지연 내역이 없습니다.<br><span class="text-xs text-slate-400">(5분 미만 지연은 증명서가 발급되지 않습니다.)</span></td></tr>`;
                return;
            }

            results.forEach(d => {
                let lineClass = "";
                if(d.line==='1') lineClass="text-[#0077DD]";
                else if(d.line==='2') lineClass="text-[#00CCAA]";
                else if(d.line==='3') lineClass="text-[#FFCC11]";
                else lineClass="text-slate-700";

                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition";
                tr.innerHTML = `
                    <td class="p-4 border-b border-slate-100">${d.date}</td>
                    <td class="p-4 border-b border-slate-100">${d.time} 경</td>
                    <td class="p-4 border-b border-slate-100 font-bold ${lineClass}">${lineNames[d.line]}</td>
                    <td class="p-4 border-b border-slate-100 font-bold text-red-500">${d.delay}분</td>
                    <td class="p-4 border-b border-slate-100">
                        <button onclick="openModal(${d.id})" class="bg-slate-800 text-white text-xs px-3 py-1.5 rounded hover:bg-black transition">발급</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // 4. 모달 열기 (데이터 주입)
        function openModal(id) {
            const data = mockDelays.find(d => d.id === id);
            if (!data) return;

            // 데이터 주입
            document.getElementById('cert-id').innerText = data.id;
            
            // 날짜 포맷 변경 (YYYY년 MM월 DD일)
            const dateParts = data.date.split('-');
            document.getElementById('cert-date').innerText = `${dateParts[0]}년 ${dateParts[1]}월 ${dateParts[2]}일`;
            
            document.getElementById('cert-line').innerText = lineNames[data.line];
            document.getElementById('cert-min').innerText = data.delay;

            // 발급일 (오늘)
            const today = new Date();
            document.getElementById('cert-today').innerText = `${today.getFullYear()}년 ${today.getMonth()+1}월 ${today.getDate()}일`;

            // 모달 표시
            document.getElementById('modal-overlay').classList.remove('hidden');
        }

        // 5. 모달 닫기
        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        // 초기 로드 시 전체 조회 실행 (테스트용)
        // document.getElementById('search-date').value = ""; // 전체 보기
        searchDelay(); 
    </script>
</body>
</html>